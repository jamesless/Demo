<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sfpay.airscape.server.dao.UserDao">
  <resultMap id="userMap" type="com.sfpay.airscape.server.vo.User">
    <id column="ID" property="id" />
    <result column="USER_NAME" property="userName" />
    <result column="PASSWORD" property="password" />
    <result column="ROLE_ID" property="roleId" />
    <result column="CREATE_TIME" property="createTime"  />
    <result column="UPDATE_TIME" property="updateTime" />
  </resultMap>
  
  	<select id="query" parameterType="String" resultMap="userMap">
		SELECT * from T_USER	
		where 
		USER_NAME = #{userName}
	</select>

	<insert id="add" parameterType="user">
		insert into
		T_USER(
			USER_NAME,
			PASSWORD,
			ROLE_ID,
			CREATE_TIME,
			UPDATE_TIME
		)
		values(
			#{userName},
			Md5(#{password}),
			"1",
			now(),
			now()
		)
	</insert>

	<update id="update" parameterType="user">
		update T_USER set
			ROLE_ID=#{roleId},
			UPDATE_TIME=now()
		where
			USER_NAME=#{userName}
	</update>

	<delete id="delete" parameterType="String">	
		delete from T_USER
		where
		ID=#{id}
	</delete>

	<select id="queryAll" resultMap="userMap">
		SELECT
		USER_NAME,ROLE_ID
		from
		T_USER where USER_NAME != 'admin'
	</select>
	
	<select id="queryByPage" parameterType="com.sfpay.airscape.server.vo.Page" resultMap="userMap">
		SELECT
		*
		from
		T_USER 
		<if test="condition != null">
		where 1=1 		
			<foreach collection="condition.keys" item="k"> 
			    <if test="null != condition[k] and '' != condition[k]">  
				and	${k} like CONCAT('%','${condition[k]}','%')
			    </if>
			</foreach> 
        </if>
		
		limit #{limitBegin} , #{pageSize}
	</select>
	
	<select id="count" resultType="java.lang.Integer">
		SELECT
		count(1)
		from
		T_USER where USER_NAME != 'admin'
	</select>
</mapper>